import{R as s,n as a,t,b as e,G as i,d as n,H as o,m as l,r as m,u as r,j as c,s as d}from"./index-sT5wyuMN.js";import{B as u}from"./button-DtbT6rDe.js";import{w as p,m as h}from"./with-default-props-YTkVgPz6.js";import{a as g}from"./attach-properties-to-component-CClyKAqJ.js";import{B as j}from"./index-B5J22Iun.js";import"./phaser-BsKGbp7r.js";import"./dot-loading-Clmf9eMD.js";import"./common-ceHGJNLy.js";const v="adm-skeleton",N=t=>p(t,s.createElement("div",{className:a(v,{[`${v}-animated`]:t.animated})})),f={lineCount:3},x=g(N,{Title:a=>p(a,s.createElement(N,{animated:a.animated,className:`${v}-title`})),Paragraph:a=>{const t=h(f,a),e=function(s,a){const t=[];for(let e=1;e<=a;e++)t.push(e);return t}(0,t.lineCount),i=s.createElement("div",{className:`${v}-paragraph`},e.map((a=>s.createElement(N,{key:a,animated:t.animated,className:`${v}-paragraph-line`}))));return p(t,i)}}),k=s=>{const a=new URLSearchParams({user_id:s.toString(),limit:String(0),page:String(0)});return t({url:"/social/getMissionStatusByUser",method:"GET",params:a})};function S(){var s;const a=e(),p=i(),h=n((s=>s.user.info));o();const g=l(),[v,N]=m.useState([]),[f,S]=m.useState(!0),[_,y]=m.useState("all");r();m.useEffect((()=>{S(!1),h&&""!==h.user_id&&(()=>{const s=new URLSearchParams({limit:String(0),page:String(0)});return t({url:"/mission/list",method:"GET",params:s})})().then((s=>{200==s.code&&(console.log("任务请求res:",s),s.data.mission_list=s.data.mission_list.map((s=>(s.loading=!1,s.status="Start",s))),console.log("userInfo = ",h),k(h.user_id).then((a=>{if(console.log("请求自己的任务状态：",a),200==a.code){const e=new Map;a.data.list.forEach((s=>{"WaitForCollect"==s.status&&(s.status="Claim"),e.set(s.name,s.status)})),s.data.mission_list=s.data.mission_list.map((s=>(e.has(s.name)&&(s.status=e.get(s.name)),s)));const i=(t=s.data.mission_list,Object.values(t.reduce(((s,a)=>{const t=a.mission_type;return s[t]||(s[t]=[]),s[t].push(a),s}),{})));N(i),S(!0)}var t})))}))}),[h]);const w="all"===_?v:v.filter((s=>s[0].mission_type===_));return c.jsxs("div",{className:"task-page fadeIn",children:[c.jsxs("div",{className:"task-title",children:[c.jsx("div",{className:"desc",children:"My BP"}),c.jsxs("div",{className:"task-score-title",children:[c.jsx("img",{src:"/assets/common/coin2x1.png",alt:"tomato",className:"unit-img"}),c.jsx("div",{className:"score",children:null==(s=null==h?void 0:h.score)?void 0:s.toLocaleString()})]})]}),c.jsx("div",{className:"task-tabs",children:v.map(((s,a)=>c.jsxs("div",{className:"task-tab "+(_===s[0].mission_type?"active":"unactive"),onClick:()=>{return a=s[0].mission_type,void y(a);var a},children:[s[0].mission_type,"(",s.length,")"]},a)))}),c.jsxs("div",{className:"task-list",children:[f?[...Array(5)].map(((s,a)=>c.jsx(x,{className:"skeleton",animated:!0},a))):c.jsx("div",{}),w.map(((s,e)=>c.jsx("div",{className:"item-wrapper",children:s.map(((s,i)=>{var n,o;return c.jsxs("div",{className:"task-list-item",children:["Social"!==s.mission_type&&c.jsx("div",{className:"task-list-top-left-corner",children:"5/10"}),c.jsxs("div",{className:"task-list-left",children:[c.jsx("img",{src:`/assets/common/${o=s.name,o.includes("Follow")||o.includes("on X")?"twitter":o.includes("Subscription")||o.includes("chat group")?"channel":(o.includes("NLH"),"task-game")}.png`,alt:"tomato",className:"middle-icon"}),c.jsxs("div",{className:"middle",children:[c.jsx("div",{className:"middle-name",children:s.name}),c.jsxs("div",{className:"reward",children:[c.jsxs("span",{children:["+",null==(n=null==s?void 0:s.score)?void 0:n.toLocaleString()]})," BP ",c.jsx("img",{src:"/assets/common/coin.png",alt:"tomato",className:"unit-img"})]})]})]}),c.jsx("div",{className:"task-list-right",children:"Finished"===s.status?c.jsx("img",{src:"assets/common/task-done.png",alt:`Action for ${s.status}`,className:"task-done-img"}):c.jsx(u,{className:`task-list-right-btn ${s.status}`,onClick:()=>(async(s,e,i)=>{console.log("test do task: item:",s);let n=JSON.parse(JSON.stringify(v));if("Done"!==s.status&&"Claim"!==s.status)n[e][i].loading=!0,N(n),"Social"==s.mission_type?"Follow hummer on X"==s.name?(g.openLink("https://twitter.com/home?lang=zh"),setTimeout((()=>{const s=[...n];n[e][i].loading=!1,n[e][i].status="Claim",N(s)}),3e3)):"Subscription hummer on channel"!=s.name&&"Join hummer on chat group"!=s.name||(g.openTelegramLink(JSON.parse(s.metadata).link),setTimeout((async()=>{const a=await((s,a,e,i)=>{const n=new URLSearchParams({chat_id:s,tg_id:a,user_id:e,mission_name:i,checkType:1});return t({url:"/bot/checked",method:"GET",params:n})})(JSON.parse(s.metadata).chat_id,p.user.id,h.user_id,s.name);if(console.log("社交任务bot检查请求=",a),111001==a.code){const s=[...n];n[e][i].loading=!1,n[e][i].status="Start",N(s)}else if(200==a.code){const s=await k(h.user_id);if(console.log("myselfStatus = ",s),200==s.code){const a=new Map;s.data.list.forEach((s=>{s.status,s.status="Claim",a.set(s.name,s.status)})),n=n.map((s=>(a.has(s.name)&&(s.status=a.get(s.name)),s)));const t=[...n];n[e][i].loading=!1,N(t)}}}),6e3)):"Poker"==s.mission_type&&s.name;else if("Claim"==s.status){const l=await(o={user_id:h.user_id,name:s.name},t({url:"/social/update",method:"POST",data:o}));if(console.log("Claim res = ",l),200==l.code){const t={...h,score:h.score+s.score},o=[...n];n[e][i].loading=!1,n[e][i].status="Finished",N(o),a(d(t))}}var o})(s,e,i),loading:s.loading,style:{cursor:"pointer"},children:s.status})})]},i)}))},e)))]}),c.jsx(j,{scrollName:"content"})]})}export{S as default};
