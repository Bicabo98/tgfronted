var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,j as i,d as a,m as o,u as r,b as n,s as c,E as l}from"./index-sT5wyuMN.js";import{p as h}from"./phaser-BsKGbp7r.js";import{b as d,e as m,T as u}from"./game-CxZlzPMw.js";import{P as g}from"./popup-BNETPUH7.js";import"./with-default-props-YTkVgPz6.js";import"./get-scroll-parent-CbYlqSdh.js";class p extends h.Scene{constructor(){super("Boot")}preload(){this.load.image("dark","assets/game/bg.png")}create(){this.scene.start("Preloader")}}const f=new h.Events.EventEmitter;class x extends h.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameOverText")}create(){f.emit("current-scene-ready",this)}changeScene(){this.scene.start("MainMenu")}}class y extends h.Scene{constructor(){super("Preloader"),t(this,"loadText")}init(){const e=document.getElementById("root"),t=e.clientWidth,s=e.clientHeight;this.add.image(t/2,s/2,"dark").setScale(t/1080,s/2297);const i=Math.max(t/2,280);this.add.rectangle(t/2,s/2,i,19).setStrokeStyle(1,16777215);const a=this.add.rectangle(t/2-i/2+5,s/2,4,14,16777215);this.loadText=this.add.text(t/2,s/2-40,"0%",{fontFamily:"Arial",fontSize:24,color:"#e3f2ed"}).setOrigin(.5,.5),this.load.on("progress",(e=>{a.width=i*e-5,this.loadText.setText(`${Math.floor(100*e)}%`)}))}preload(){this.load.setPath("assets/game"),this.load.image("game-cat","game-cat.png"),this.load.image("cat","cat.png"),this.load.image("unit","unit.png"),this.load.image("freezeBg","freezeBg.png"),this.load.image("boomBg","boomBg.png"),this.load.image("freeze","freeze.gif"),this.load.image("boom","boom.gif")}create(){f.emit("current-scene-ready",this),this.scene.start("MainGame")}}class v extends Phaser.Scene{constructor(){super("MainMenu"),t(this,"fontStyle",{fontFamily:"Arial",fontSize:34,color:"#ffffff",fontStyle:"bold",padding:16,align:"center",lineHeight:36}),t(this,"music"),t(this,"totalScoreText"),t(this,"totalScore",0),t(this,"maxScore",0),t(this,"kouFen",!1),t(this,"target",0)}create(){const e=document.getElementsByClassName("layout"),t=e[0].clientWidth,s=e[0].clientHeight;let i=this.add.image(t/2,s/2,"dark").setInteractive();this.volumeButton(),this.tweens.add({targets:i,alpha:{from:0,to:1},duration:1e3}),this.add.text(t/2,s/2+200,"warning: find two identical expressions\n and eliminate them before clearing the level",{...this.fontStyle,fontSize:13,color:"#f5f5f5"}).setOrigin(.5,.5);const a=this.add.text(t/2,s/2+120,"Click to Play",{align:"center",strokeThickness:4,fontSize:32,fontStyle:"bold",color:"#000000"}).setOrigin(.5).setDepth(3),o=this.add.tween({targets:a,duration:800,ease:e=>e>.8,alpha:0,yoyo:!0,repeat:-1});this.music||(this.music=this.sound.play("music",{loop:!0}));const r=localStorage.getItem("volume")||1;this.sound.setVolume(r);let n=this.add.image(t/2,0,"logo");this.tweens.add({targets:n,y:s/2-50,alpha:{from:0,to:1},ease:"bounce.out",duration:1200}),i.on(Phaser.Input.Events.POINTER_DOWN,(async()=>{if(this.kouFen)return;o.stop(),a.setAlpha(0);const e=await d();if(0!=e.code)this.sound.play("card-mismatch"),this.totalScoreText.setColor("#e20f0f"),this.cameras.main.shake(300,.01);else{const i=this.add.text(t/2,s/2-250,""+(e.data.score-this.totalScore),{...this.fontStyle,fontSize:22,color:"#ec3942"}).setOrigin(.5,.5);this.tweens.add({targets:i,alpha:{from:1,to:0},duration:1500}),this.kouFen=!0,this.target=e.data.score,this.registry.set("totalScore",e.data.score)}})),f.emit("current-scene-ready",this)}volumeButton(){const e=this.add.image(25,30,"volume-icon").setName("volume-icon");e.setInteractive(),e.on(Phaser.Input.Events.POINTER_OVER,(()=>{this.input.setDefaultCursor("pointer")})),e.on(Phaser.Input.Events.POINTER_OUT,(()=>{console.log("Mouse leave"),this.input.setDefaultCursor("default")}));const t=localStorage.getItem("volume")||1;e.setTexture(1==t?"volume-icon":"volume-icon_off"),e.setAlpha(1==t?1:.5),console.log(t),e.on(Phaser.Input.Events.POINTER_DOWN,(()=>{0===this.sound.volume?(this.sound.setVolume(1),localStorage.setItem("volume","1"),e.setTexture("volume-icon"),e.setAlpha(1)):(localStorage.setItem("volume","0"),this.sound.setVolume(0),e.setTexture("volume-icon_off"),e.setAlpha(.5))}))}update(){this.kouFen&&(this.totalScore=this.totalScore-20,this.totalScore<this.target?(this.totalScoreText.setText(`Score: ${this.target}`),this.target-this.totalScore>500&&(this.scene.start("MainGame"),this.kouFen=!1)):this.totalScoreText.setText(`Score: ${this.totalScore}`))}showTotal(e){const t=document.getElementsByClassName("layout"),s=t[0].clientWidth,i=t[0].clientHeight;this.totalScore?(this.totalScore=this.registry.get("totalScore"),this.maxScore=this.registry.get("maxScore")):(this.totalScore=e.score,this.maxScore=e.game_max_score,this.registry.set("totalScore",this.totalScore),this.registry.set("maxScore",this.maxScore)),this.totalScoreText=this.add.text(s/2,i/2-220,`Score:${this.totalScore||0}`,this.fontStyle).setOrigin(.5,.5),this.tweens.add({targets:this.totalScoreText,alpha:{from:0,to:1},scale:{from:0,to:1},duration:1e3});const a=this.add.text(s/2,i/2-180,`High Score: ${this.maxScore||0}`,{...this.fontStyle,fontSize:24}).setOrigin(.5,.5).setAlpha(0);this.tweens.add({targets:a,alpha:{from:0,to:1},scale:{from:.5,to:1},duration:800,delay:500})}}class S extends Phaser.Scene{constructor(){super("MainGame"),t(this,"score",0),t(this,"scoreText"),t(this,"timer"),t(this,"shakeTimer"),t(this,"timerText"),t(this,"width",0),t(this,"height",0),t(this,"autoCreateTimer"),t(this,"images",[]),t(this,"freeze",!1),t(this,"timerCount",30),t(this,"fontStyle",{fontFamily:"Arial",fontSize:20,color:"#000000",fontStyle:"bold"}),this.score=0,this.scoreText,this.timer=null,this.timerText,this.shakeTimer,this.freeze=!1,this.timerCount=30}init(){this.cameras.main.fadeIn(500)}create(){const e=document.getElementsByClassName("layout"),t=e[0].clientWidth,s=e[0].clientHeight;this.width=t,this.height=s,this.add.image(t/2,s/2,"dark").setScale(t/1125,s/2115);const i=this.add.graphics({x:50,y:50}).setDepth(1e3);i.fillStyle(16777215,.8),i.fillRoundedRect(0,0,70,30,12).setPosition(10,5),i.fillStyle(16711935,1),this.timerText=this.add.text(45,20,`${this.timerCount}:00`,this.fontStyle).setOrigin(.5,.5).setDepth(1e3),this.scoreText=this.add.text(t-30,20,`${this.score}`,{...this.fontStyle,color:"#ffffff"}).setOrigin(.5,.5).setDepth(1e3),this.scoreText.setShadow(1,1,"#000000",2),this.add.image(t-60,20,"cat").setScale(.45,.45).setDepth(1e3),f.emit("current-scene-ready",this),setTimeout((()=>{this.start()}),1e3)}start(){this.score=0,this.timer=this.time.addEvent({delay:1e3*this.timerCount,callback:this.gameOver,callbackScope:this}),this.autoCreateTimer=setInterval((()=>{this.autoCreateIcon()}),140)}reStart(){this.freeze=!1,this.timer=this.time.addEvent({delay:1e3*this.timerCount,callback:this.gameOver,callbackScope:this}),this.autoCreateTimer=setInterval((()=>{this.autoCreateIcon()}),200)}autoCreateIcon(){try{let e={score:1,speed:4,width:80,type:"cat"};const t=170,s=Math.random();s<.95?e=s>0&&s<=.11?{width:50,score:3,speed:Math.random()+2.5,type:"cat"}:s>.11&&s<=.47?{width:75,score:5,speed:Math.random()+3,type:"cat"}:s>.47&&s<=.84?{width:85,score:8,speed:Math.random()+3.5,type:"cat"}:{width:100,score:14,speed:Math.random()+4,type:"cat"}:s<.98&&s>=.95?this.images.filter((e=>"freeze"==e.type)).length||(e={width:60+10*Math.random(),score:0,speed:Math.random()+3,type:"freeze"}):this.images.filter((e=>"boom"==e.type)).length||(e={width:60+10*Math.random(),score:-300,speed:Math.random()+3,type:"boom"});let i,a=Math.random()*this.width;a<e.width/2&&(a=e.width/2+12),a>this.width-e.width/2&&(a=this.width-e.width/2-12),i="cat"==e.type?this.add.image(a,0,"game-cat").setInteractive().setScale(e.width/t,e.width/t).setDepth(10):this.add.image(a,0,e.type).setInteractive().setScale(e.width/200,e.width/200).setDepth(10),this.images.push({icon:i,speed:e.speed,maxY:this.height+200,type:e.type,score:e.score}),i.on("pointerdown",(()=>{if("boom"==e.type){this.shake();const t=this.add.text(i.x,i.y,`${e.score}`,{fontSize:24,color:"#ff0000",stroke:"#000000",strokeThickness:2,fontStyle:"bold"}).setDepth(10);this.add.tween({targets:t,alpha:{from:1,to:0},ease:"Linear",duration:1e3}),this.score=Math.max(this.score+e.score,0),this.scoreText.setText(this.score).setColor("#ffffff");const s=1125,a=2115,o=this.add.image(this.width/2,this.height/2,`${e.type}Bg`).setScale(this.width/s,this.height/a);setTimeout((()=>{o.destroy()}),1e3),this.images=this.images.filter((e=>{var t;return!(Math.abs(e.icon.x-i.x)<200&&Math.abs(e.icon.y-i.y)<200&&(null==(t=null==e?void 0:e.icon)||t.destroy(),1))}))}if("freeze"==e.type){this.freeze=!0,this.timerCount=Math.round((this.timer.delay-this.timer.elapsed)/1e3),this.time.removeEvent(this.timer),this.timer=null,clearInterval(this.autoCreateTimer);const t=1125,s=2115,a=this.add.image(this.width/2,this.height/2,`${e.type}Bg`).setScale(this.width/t,this.height/s);f.emit("execTypeCmd",e.type),setTimeout((()=>{this.reStart(),a.destroy(),f.emit("execTypeCmd","")}),4e3),i.destroy()}"cat"==e.type&&(this.images=this.images.filter((e=>{var t;if(Math.abs(e.icon.x-i.x)<50&&Math.abs(e.icon.y-i.y)<50&&"cat"==e.type){const s=this.add.text(e.icon.x,e.icon.y,`+${e.score}`,{fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,fontStyle:"bold"}).setDepth(10);return this.add.tween({targets:s,alpha:{from:1,to:0},ease:"Linear",duration:1e3}),null==(t=null==e?void 0:e.icon)||t.destroy(),this.score+=null==e?void 0:e.score,!1}return!0})),this.scoreText.setText(this.score),f.emit("execBoom",{left:i.x,top:i.y,show:!0}),setTimeout((()=>{f.emit("execBoom",{left:i.x,top:i.y,show:!1})}),300))}))}catch{clearInterval(this.autoCreateTimer)}}shake(){this.cameras.main.shake(100,.01)}update(){if(this.timer)if(1===this.timer.getProgress())this.timerText.setText("00:00"),this.time.removeAllEvents(),this.timer=null,this.timerCount=30,clearInterval(this.autoCreateTimer);else{const e=(this.timerCount-this.timer.getElapsedSeconds()).toPrecision(4),t=e.indexOf(".");let s=e.substring(0,t),i=e.substr(t+1,2);s=Phaser.Utils.String.Pad(s,2,"0",1),this.timerText.setText(s+":"+i),this.freeze||this.images.map(((e,t)=>{e.icon.y+=e.speed,e.icon.y>e.maxY&&this.images.splice(t,1),"cat"!==e.type&&(e.icon.rotation+=.05*Math.random())}))}}async gameOver(){this.time.removeAllEvents(),clearInterval(this.autoCreateTimer),this.timer=null,setTimeout((()=>{localStorage.setItem("currentScore",this.score),this.scene.start("GameOver")}),1e3)}}const w={type:h.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#181818",scene:[p,y,v,S,x]},T=s.forwardRef((function({currentActiveScene:e,size:t},a){const o=s.useRef(null),r=s.useRef(),[n,c]=s.useState(""),[l,d]=s.useState({show:!1,top:0,left:0});return s.useLayoutEffect((()=>(null===o.current&&(o.current=(()=>{const e=document.getElementsByClassName("layout"),t=e[0].clientWidth,s=e[0].clientHeight;return new h.Game({...w,parent:"game-container",width:t,height:s})})(),"function"==typeof a?a({game:o.current,scene:null}):a&&(a.current={game:o.current,scene:null})),()=>{o.current&&(o.current.destroy(!0),null!==o.current&&(o.current=null))})),[a]),s.useEffect((()=>(f.on("current-scene-ready",(t=>{e&&"function"==typeof e&&e(t),"function"==typeof a?a({game:o.current,scene:t}):a&&(a.current={game:o.current,scene:t})})),f.on("execTypeCmd",(e=>{c(e)})),f.on("execBoom",(e=>{d(e)})),()=>{f.removeListener("current-scene-ready"),f.removeListener("execTypeCmd"),f.removeListener("execBoom")})),[e,a]),i.jsxs("div",{ref:r,children:[i.jsx("div",{id:"game-container"}),i.jsxs("div",{className:"freeze-gif",style:{opacity:"freeze"==n?1:0,zIndex:"freeze"==n?10:-1},children:[i.jsx("img",{src:"/assets/game/freezeAg.gif",alt:"gif",className:"tl"}),i.jsx("img",{src:"/assets/game/freezeAg.gif",alt:"gif",className:"tr"}),i.jsx("img",{src:"/assets/game/freezeAg.gif",alt:"gif",className:"bl"}),i.jsx("img",{src:"/assets/game/freezeAg.gif",alt:"gif",className:"br"})]}),i.jsx("img",{src:"/assets/game/click.gif",alt:"boom",className:"get-score",style:{left:l.left,top:l.top,opacity:l.show?1:0,zIndex:l?10:-1}})]})}));function b(){const e=s.useRef(null),t=a((e=>e.user.info)),[h,p]=s.useState("Preloader"),[f,x]=s.useState(0),y=`https://t.me/HamstersTon_bot/Hamster?startapp=${btoa(t.user_id)}`,[v,S]=s.useState(!1),w=o(),b=r(),k=n(),j=l.getInstance(),[C,N]=s.useState(!1),I=a((e=>e.user.system)),M=()=>{const e=y,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),u.show({content:"copied",position:"top"})},z=()=>{const e=`I scored ${f} points in Cat Game!\nI dare you to challenge me!\nFarm $HMSTR with me and secure your token allocation through Tomarket.ai.\nUse my link to get 2,000 $HMSTR!`;w.shareURL(y,e)};return i.jsxs("div",{className:"game-wrapper",children:["GameOver"==h?i.jsxs("div",{className:"game-over",children:[i.jsxs("div",{className:"game-over-top",children:[i.jsx("img",{src:"/assets/game/reward.png",alt:"gif",className:"congrats-img"}),i.jsx("div",{className:"congrats",children:"Congrats!"}),i.jsx("div",{className:"congrats",children:"bountiful harvest"}),i.jsxs("div",{className:"score-wrapper",children:[i.jsx("span",{children:"+"}),i.jsxs("span",{children:[f," "]}),i.jsx("img",{src:"/assets/common/cat.webp",alt:"tomato"})]})]}),i.jsxs("div",{className:"game-over-bots",children:[i.jsx("div",{className:"game-over-btn",onClick:()=>{S(!0)},children:"Share Your Results +500"}),i.jsx("div",{className:"game-over-btn play-btn",onClick:()=>{0!=t.ticket?p("Preloader"):N(!0)},children:i.jsxs("div",{className:"game-over-bot-middle",children:["Play (",t.ticket," Attempts Left)"]})})]})]}):i.jsx(T,{ref:e,currentActiveScene:async e=>{if(p(e.scene.key),"GameOver"==e.scene.key){j.emit("showCongrates",{time:2e3,visible:!0});const e=localStorage.getItem("currentScore")||0;parseInt(e)&&(j.emit("showCongrates",{time:1e3,visible:!0}),x(e),m({score:1*e}).then((e=>{0==e.code&&k(c(e.data))})).catch((e=>{console.error(e)})))}if("MainGame"==e.scene.key){const e=await d();0!=e.code?b(-1):k(c(e.data))}}}),i.jsx(g,{visible:v,onMaskClick:()=>{S(!1)},bodyStyle:{borderTopLeftRadius:"8px",borderTopRightRadius:"8px"},children:i.jsxs("div",{className:"popup-result",children:[i.jsxs("div",{className:"popup-title",children:["Share Results",i.jsx("svg",{onClick:()=>S(!1),className:"close-svg",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5777",width:"16",height:"16",children:i.jsx("path",{d:"M597.795527 511.488347 813.564755 295.718095c23.833825-23.833825 23.833825-62.47489 0.001023-86.307691-23.832801-23.832801-62.47489-23.833825-86.307691 0L511.487835 425.180656 295.717583 209.410404c-23.833825-23.833825-62.475913-23.833825-86.307691 0-23.832801 23.832801-23.833825 62.47489 0 86.308715l215.769228 215.769228L209.410915 727.258599c-23.833825 23.833825-23.833825 62.47489 0 86.307691 23.832801 23.833825 62.473867 23.833825 86.307691 0l215.768205-215.768205 215.769228 215.769228c23.834848 23.833825 62.475913 23.832801 86.308715 0 23.833825-23.833825 23.833825-62.47489 0-86.307691L597.795527 511.488347z",fill:"#272636","p-id":"5778"})})]}),i.jsxs("div",{className:"popup-content",children:[i.jsx("div",{className:"popup-content-jb",children:"🏆"}),i.jsxs("div",{className:"score-wrapper",children:[i.jsx("span",{children:"+"}),i.jsxs("span",{children:[f," "]}),"$HMSTR"]}),i.jsxs("div",{children:["I scored ",f," points in Hamster Game!"]}),i.jsx("div",{children:"I dare you to challenge me!"}),i.jsx("div",{className:"popup-content-btn",onClick:()=>M(),children:"Copy link"}),i.jsx("div",{className:"popup-content-btn btn-send",onClick:()=>z(),children:"Send"})]})]})}),i.jsx(g,{visible:C,onMaskClick:()=>{N(!1)},bodyStyle:{borderTopLeftRadius:"8px",borderTopRightRadius:"8px"},className:"popup-invite",children:i.jsxs("div",{className:"popup-frens",children:[i.jsxs("div",{className:"title",children:["Invite a Fren",i.jsx("svg",{onClick:()=>N(!1),className:"close-svg",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5777",width:"18",height:"18",children:i.jsx("path",{d:"M597.795527 511.488347 813.564755 295.718095c23.833825-23.833825 23.833825-62.47489 0.001023-86.307691-23.832801-23.832801-62.47489-23.833825-86.307691 0L511.487835 425.180656 295.717583 209.410404c-23.833825-23.833825-62.475913-23.833825-86.307691 0-23.832801 23.832801-23.833825 62.47489 0 86.308715l215.769228 215.769228L209.410915 727.258599c-23.833825 23.833825-23.833825 62.47489 0 86.307691 23.832801 23.833825 62.473867 23.833825 86.307691 0l215.768205-215.768205 215.769228 215.769228c23.834848 23.833825 62.475913 23.832801 86.308715 0 23.833825-23.833825 23.833825-62.47489 0-86.307691L597.795527 511.488347z",fill:"#272636","p-id":"5778"})})]}),i.jsxs("div",{className:"content",children:[i.jsxs("div",{className:"content-desc",children:[i.jsxs("div",{children:["Get ",null==I?void 0:I.invite_add," $HMSTR and ",null==I?void 0:I.ticket," ticket（Invite a Friend）"]}),i.jsxs("div",{children:["Get ",null==I?void 0:I.huiYuan_add," $HMSTR and ",null==I?void 0:I.huiYuan_ticket," tickets（Invite a Telegram Premium）"]})]}),i.jsx("div",{className:"popup-content-btn",onClick:()=>M(),children:"Copy link"}),i.jsx("div",{className:"popup-content-btn btn-send",onClick:()=>z(),children:"Send"})]})]})})]})}export{b as default};
